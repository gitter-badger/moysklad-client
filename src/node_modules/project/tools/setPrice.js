/**
 * setPrice
 * Date: 07.08.14
 * Vitaliy V. Makeev (w.makeev@gmail.com)
 */

var _ = require('lodash');

/**
 * Устанавливает цену для позиции motion документа
 * @param motion Элемент типа moysklad.motion
 * @param value Значение цены в сотых долях единицы валюты документа
 * @param [discount] Скидка
 */
var setPrice = function (motion, value, discount) {

    if (motion) {
        motion.basePrice = motion.basePrice || {};
        motion.price     = motion.price || {};

        var sum = {};

        if (typeof value === 'object') {
            sum.sum             = value.sum;
            sum.sumInCurrency   = value.sumInCurrency;

        } else if (typeof value === 'number') {
            sum.sum = sum.sumInCurrency = value;

        } else {
            throw new TypeError('Incorrect value parameter');
        }

        motion.basePrice = sum;

        if (discount) {
            motion.discount             = discount;
            motion.price.sum            = sum.sum * (1 - discount / 100);
            motion.price.sumInCurrency  = sum.sumInCurrency * (1 - discount / 100);

        } else {
            _.extend(motion.price, sum);
        }

    }

    return this;
};

module.exports = setPrice;