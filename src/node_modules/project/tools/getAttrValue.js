/**
 * getAttribute
 * Date: 01.06.14
 * Vitaliy V. Makeev (w.makeev@gmail.com)
 */

var _       = require('lodash')
  , getType = require('./getType');

var attributeValue = getType('attributeValue');

var attributeFields = _(attributeValue.propertyInfos)
    .map('name').pull('metadataUuid').value();

/*var attributeFields = [
 'valueText',
 'valueString',
 'doubleValue',
 'longValue',
 'booleanValue',
 'timeValue',
 'entityValueUuid',
 'agentValueUuid',
 'goodValueUuid',
 'placeValueUuid',
 'consignmentValueUuid',
 'contractValueUuid',
 'projectValueUuid',
 'employeeValueUuid'
 ];*/

/**
 * Получение значения аттрибута по metadataUuid
 * (осуществляется методом перебора возможных полей без дополнительной загрузки метаданных)
 * @param entity Сущность с аттрибутами
 * @param metadataUuid Идентификатор метаданных аттрибута
 * @returns {*}
 */
var getAttrValue = function (entity, metadataUuid) {

    var attribute = _.find(entity.attribute, { metadataUuid: metadataUuid });

    if (attribute) {
        var fieldName = _.find(attributeFields, function (fieldName) {
            return fieldName in attribute;
        });

        if (fieldName) return attribute[fieldName];
    }
};

module.exports = getAttrValue;