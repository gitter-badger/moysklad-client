/**
 * Default Http request provider factory
 * Date: 11.01.14
 * Vitaliy V. Makeev (w.makeev@gmail.com)
 */

var Fiber;

try {
    Fiber = require('fibers')
} catch (e) {}

var _               = require('lodash'),
    callbackAdapter = require('./../../../tools/callbackAdapter');

var fetch = {

    fetch: function (options, callback) {
        if (Fiber && Fiber.current) {
            var result;
            require('./common-node').fetch(options, function (err, result) {
                result = callbackAdapter(err, result, callback);
            });
            return result;

        } else {
            if (!callback) throw new Error('fetch: callback must be defined in async mode');
            require('./node').fetch(options, callback);
        }
    }
};

module.exports = fetch;
