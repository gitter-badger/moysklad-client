/**
 * Default Http request provider factory
 * Date: 11.01.14
 * Vitaliy V. Makeev (w.makeev@gmail.com)
 */

var Fiber;

try {
    Fiber = require('fibers')
} catch (e) {}

var nodeFetch = require('./node').fetch;

var fetch = {

    fetch: function (options, callback) {
        if (Fiber && Fiber.current) {
            var fiber = Fiber.current;
            nodeFetch(options, function (err, data) {
                fiber.run({ error: err, data: data });
            });
            var result = Fiber.yield();
            callback(result.error, result.data);
        } else {
            if (!callback) throw new Error('fetch: callback must be defined in async mode');
            nodeFetch(options, callback);
        }
    }
};

module.exports = fetch;
