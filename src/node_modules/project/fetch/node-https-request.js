var url               = require('url'),
    https             = require('https');

module.exports = function httpsRequest(opt, cb) {
    var parsedUrl = url.parse(opt.url);
    var reqOptions = {
        hostname: parsedUrl.hostname,
        port: 443,
        path: parsedUrl.path,
        method: opt.method,
        headers: opt.headers
    };

    if (opt.body) {
        opt.headers['Content-Length'] = opt.body.length
    }

    var req = https.request(reqOptions, function (res) {
        var body = '';
        res.setEncoding('utf8');
        res.on('data', function (chunk) {
            body += chunk;
        });
        res.on('end', function () {
            cb(null, res, body)
        })
    });

    req.on('error', cb);

    if (opt.body) {
        req.write(opt.payload);
    }

    req.end();
};

